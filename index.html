<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>COVID 19 Updates</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/fontawesome.min.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Today</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <h3>New Cases</h3>
                <button type="button" id="newConfirmed" class="p-2 btn btn-primary" disabled></button>
            </div>
            <div class="col-sm-3">
                <h3>New Deaths</h3>
                <button type="button" id="newDeaths" class="p-2 btn btn-danger" disabled></button>
            </div>
        </div>
        <div class="mb-5"></div>
        <div class="row">
            <div class="col-sm-3">
                <h3>Total Cases</h3>
                <button type="button" id="totalConfirmed" class="p-2 btn btn-primary" disabled></button>
            </div>
            <div class="col-sm-3">
                <h3>Total Deaths</h3>
                <button type="button" id="totalDeaths" class="p-2 btn btn-danger" disabled></button>
            </div>
        </div>
        <div class="mb-5"></div>
        <div class="row" id="more">
        </div>
    </div>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        const countryCode = "PK";
        const splitLength = 7;
        $.getJSON("https://api.covid19api.com/summary", function (data) {
            let countryData = data.Countries.filter(x => x.CountryCode === countryCode)
            if (Array.isArray(countryData) && countryData.length > 0) countryData = countryData[0];
            const totalConfirmed = countryData.TotalConfirmed;
            const totalDeaths = countryData.TotalDeaths;
            const totalRecovered = countryData.TotalRecovered;
            const newConfirmed = countryData.NewConfirmed;
            const newDeaths = countryData.NewDeaths;
            const newRecovered = countryData.NewRecovered;
            const date = countryData.Date;

            $("#country").text(countryData);
            $("#totalConfirmed").text(totalConfirmed);
            $("#totalDeaths").text(totalDeaths);
            $("#totalRecovered").text(totalRecovered);
            $("#newConfirmed").text(newConfirmed);
            $("#newDeaths").text(newDeaths);
            $("#newRecovered").text(newRecovered);
            $("#date").text(date);
        });

        $.getJSON("https://api.covid19api.com/country/PK", function(data) {
            let html = "";
            let lastConfirmedCases, lastConfirmedDeaths;

            const startIndex = data.length - splitLength - 2;

            lastConfirmedCases = data[startIndex].Confirmed;
            lastConfirmedDeaths = data[startIndex].Deaths;

            data
                .slice(startIndex, data.length)
                .map(x => {
                    x.NewConfirmed = x.Confirmed - lastConfirmedCases;
                    x.NewDeaths = x.Deaths - lastConfirmedDeaths;
                    x.DateString = new Date(x.Date).toLocaleDateString();

                    lastConfirmedCases = x.Confirmed;
                    lastConfirmedDeaths = x.Deaths;

                    return x;
                })
                .reverse()
                .slice(0, splitLength)
                .forEach(x =>
                    html += `<div class="col-sm-3 mb-3">
                        <h3>${x.DateString}</h3>
                        <button type="button" class="p-2 btn btn-primary" disabled>${x.NewConfirmed}</button>
                        <button type="button" class="p-2 btn btn-danger" disabled>${x.NewDeaths}</button>
                    </div>`
            );

            $("#more").html(html);
        });
    });
</script>
</body>
</html>
